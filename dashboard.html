<!DOCTYPE html>
<html lang="en">
<head> <link rel="icon" type="image/x-icon" href="images/logo.png">
 <link rel="icon" type="image/x-icon" href="images/logo.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sickbay Management System</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head> <script type="module" src="authGuard.js"></script>
<body>
    <div class="app-container">
        <div class="sidebar">
            <div class="logo">
                <img src="images/logo.png" width="50" height="50">
                <span>Sickbay MS</span>
            </div>
            <nav class="nav-menu">
                <a href="dashboard.html" class="nav-item active">
                    <i class="fas fa-house"></i>
                    <span>Dashboard</span>
                </a>
                <a href="students.html" class="nav-item">
                    <i class="fas fa-users"></i>
                    <span>Students</span>
                </a>
                <a href="prescriptions.html" class="nav-item">
                    <i class="fas fa-prescription-bottle-alt"></i>
                    <span>Prescriptions</span>
                </a>
                <a href="stocks.html" class="nav-item">
                    <i class="fas fa-boxes"></i>
                    <span>Stock Management</span>
                </a>
                <a href="analytics.html" class="nav-item">
                    <i class="fas fa-chart-line"></i>
                    <span>Analytics</span>
                </a>
                <a href="notes.html" class="nav-item">
                    <i class="fas fa-sticky-note"></i>
                    <span>Notes</span>
                </a>
                      <a href="chat bot.html" class="nav-item">
                    <i class="fas fa-robot"></i>
                    <span>The Med Bot</span>
                </a>
                <a href="chat.html" class="nav-item">
                    <i class="fas fa-envelope"></i>
                    <span>Chat-Room</span>
                </a>
                  <a href="Locater.html" class="nav-item">
                    <i class="fas fa-map"></i>
                    <span>GPS</span>
                </a>
                <a href="about.html" class="nav-item">
                    <i class="fa-solid fa-address-card"></i>
                    <span>About Us</span>
                </a>
                <a href="contact us.html" class="nav-item">
                    <i class="fas fas fa-phone"></i>
                    <span>Contact Us</span>
                </a>
                <a href="#" class="nav-item" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
                
            </nav>
        </div>

        <main class="main-content">
            <header class="header">
                
                <div class="page-header">
                    <h1>Dashboard</h1>
                </div>
            </header>

            <div class="content">
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalStudents">126</h3>
                    <p>Total Students</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-prescription-bottle-alt"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalDrugs">12</h3>
                    <p>Total Drugs</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="stat-info">
                    <h3 id="stockValue">1,234,000</h3>
                    <p>Stock Value</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="stat-info">
                    <h3 id="completedStudents">228</h3>
                    <p>Completed Students</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-prescription"></i>
                </div>
                <div class="stat-info">
                    <h3 id="visitPrescriptions">1234</h3>
                    <p>Visit Prescriptions</p>
                </div>
            </div>
        </div>
        
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <div class="card-header">
                    <h3><i class="fas fa-clock"></i> Recent Activities</h3>
                </div>
                <div class="card-body">
                    <div id="recentActivities">
                        <div class="activity-item">
                            <div class="activity-icon">
                                <i class="fas fa-pills"></i>
                            </div>
                            <div class="activity-info">
                                <p class="activity-text">No recent activities</p>
                                <span class="activity-time">Start managing prescriptions to see activities</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-card">
                <div class="card-header">
                    <h3><i class="fas fa-exclamation-circle"></i> Pending Actions</h3>
                </div>
                <div class="card-body">
                    <div id="pendingActions">
                        <div class="pending-item">
                            <i class="fas fa-info-circle"></i>
                            <span>No pending actions</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        
        <div class="dashboard-card full-width">
            <div class="card-header">
                <h3><i class="fas fa-chart-bar"></i> Health Statistics</h3>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="healthChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>

        
            </div>
        </main>
    </div>

    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/auth.js"></script>
    <script type="module" src="js/dashboard.js"></script>
    <script type="module" src="js/utils.js"></script>
<script type="module">
  import { checkAuth } from './auth.js';

  // Ensure user is logged in
  checkAuth().then(user => {
    console.log("User authenticated:", user.email);
  }).catch(err => {
    console.warn("Access blocked:", err);
  });
</script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBPbc82p3XWtzH0X4Ougj9MPeDiJF9vzYk",
    authDomain: "sms-db-7b1c7.firebaseapp.com",
    databaseURL: "https://sms-db-7b1c7-default-rtdb.firebaseio.com",
    projectId: "sms-db-7b1c7",
    storageBucket: "sms-db-7b1c7.firebasestorage.app",
    messagingSenderId: "848657966289",
    appId: "1:848657966289:web:3d4ab0afabc6bc9b57d1f0",
    measurementId: "G-45LBM5CTZ0"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  function setupRealtimeUpdates() {
    console.log("Setting up Firestore real-time listener...");
    const statsDocRef = doc(db, "dashboardStats", "main");

    onSnapshot(statsDocRef, (docSnapshot) => {
      if (docSnapshot.exists()) {
        const stats = docSnapshot.data();
        console.log("Real-time update received:", stats);

        document.getElementById("totalStudents").textContent = stats.totalStudents || 0;
        document.getElementById("totalDrugs").textContent = stats.totalDrugs || 0;
        document.getElementById("stockValue").textContent = stats.stockValue || 0;
        document.getElementById("completedStudents").textContent = stats.completedStudents || 0;
        document.getElementById("visitPrescriptions").textContent = stats.visitPrescriptions || 0;
      } else {
        console.warn("No dashboard stats found in Firestore.");
      }
    }, (error) => {
      console.error("Error listening to Firestore updates:", error);
    });
  }

  // Initialize real-time updates on page load
  document.addEventListener("DOMContentLoaded", () => {
    console.log("Initializing real-time updates...");
    setupRealtimeUpdates();
  });
</script>
<script>
    (function(){if(!window.chatbase||window.chatbase("getState")!=="initialized"){window.chatbase=(...arguments)=>{if(!window.chatbase.q){window.chatbase.q=[]}window.chatbase.q.push(arguments)};window.chatbase=new Proxy(window.chatbase,{get(target,prop){if(prop==="q"){return target.q}return(...args)=>target(prop,...args)}})}const onLoad=function(){const script=document.createElement("script");script.src="https://www.chatbase.co/embed.min.js";script.id="hpdHBnuYRh4IS6084J4zS";script.domain="www.chatbase.co";document.body.appendChild(script)};if(document.readyState==="complete"){onLoad()}else{window.addEventListener("load",onLoad)}})();
    </script>
</html>
